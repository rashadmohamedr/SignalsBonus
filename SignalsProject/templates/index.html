{% extends "layout.html" %}

{% block content %}
<!DOCTYPE html>
<html>
<head>
    <title>Audio Distortion Analysis</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Audio Distortion Analysis</h1>

    {% if error %}
    <p style="color: red;">{{ error }}</p>
    {% endif %}

    <p>Distortion Percentage: {{ distortion_percentage }}</p>

    <canvas id="signalsChart"></canvas>
    <canvas id="spectrumChart"></canvas>

    <h2>Calculate Distortion</h2>
    <form method="POST" enctype="multipart/form-data">
        <h3>Upload Audio File</h3>
        <input type="file" name="audioFile" accept=".wav,.mp3,.ogg">
        <button type="submit">Analyze</button>
    </form>
    <br>
    <form method="POST">
        <h3>Or Enter Parameters</h3>
        <label for="frequency">Frequency (Hz):</label>
        <input type="number" id="frequency" name="frequency" value="1000"><br>

        <label for="samplingFrequency">Sampling Frequency (Hz):</label>
        <input type="number" id="samplingFrequency" name="samplingFrequency" value="44000"><br>

        <button type="submit">Calculate</button>
    </form>
    <script>
        // Get chart data from Flask
        const chartData = {{ chart_data | tojson }};

        // Create the signals chart
        const signalsCtx = document.getElementById('signalsChart').getContext('2d');
        new Chart(signalsCtx, {
            type: 'line',
            data: {
                labels: chartData.time,
                datasets: [
                    {
                        label: 'Input Signal',
                        data: chartData.input_signal,
                        borderColor: 'blue',
                        fill: false
                    },
                    {  // New dataset for output signal
                        label: 'Output Signal',
                        data: chartData.output_signal, // Make sure this data is sent from Flask
                        borderColor: 'red',
                        fill: false
                    }
                ]
            }
        });

        // Create the frequency spectrum chart
        const spectrumCtx = document.getElementById('spectrumChart').getContext('2d');
        new Chart(spectrumCtx, {
            type: 'line',
            data: {
                labels: chartData.frequencies,
                datasets: [{
                    label: 'Magnitude',
                    data: chartData.magnitudes,
                    borderColor: 'green',
                    fill: false
                }]
            }
        });
    </script>

</body>
</html>

{% endblock %}